import{h as N}from"./QSelect.094e4cd6.js";import{d as L,g as b,_ as J,P as V,o as M,aF as q,w as o,e as l,l as y,i as $,j as w,C as W,aG as O,aH as S,Q as H,aM as K,bp as X,bq as Z,f as n,q as A,r as x,aI as ee}from"./index.cfa62c89.js";import{Q as ae}from"./QForm.984041a7.js";import{Q as Y,a as p}from"./QTable.a99d1b42.js";import{Q as le,a as oe,b as B}from"./QBar.b6fed293.js";import{Q as te}from"./QPage.1777d14d.js";import{s as E,a as C}from"./axios.55b105d8.js";import"./selection.fe56f4bf.js";import"./QList.0f7219f7.js";const re=L({name:"BuscadorPartida",emits:["partida-seleccionada"],setup(a,{emit:t}){const g=b(null),h=b(!1),s=b(""),P=[{name:"poliza",label:"Poliza",align:"left",field:"id_poliza",sortable:!0},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion",sortable:!0}],d=b([]),e=b([...d.value]),m=()=>{s.value===null?e.value=d.value:e.value=d.value.filter(v=>v.id_poliza.toLowerCase().includes(s.value)||v.descripcion.toLowerCase().includes(s.value.toLowerCase()))},F=(v,_)=>{h.value=!1,t("partida-seleccionada",_.id_poliza)},I=()=>{h.value=!1},k=async()=>{var v;h.value=!0,await new Promise(_=>setTimeout(_,250)),(v=g.value)==null||v.focus(),Q()},Q=()=>{let v=JSON.parse(V.getItem("empresa").toString());if(!v.id){E("Debe Seleccionar la Empresa",{tipo:"negative"});return}let _=V.getItem("periodo");if(!_){E("Debe Seleccionar el Periodo para la Empresa Correspondiente",{tipo:"negative"});return}C.get("partidamanual",{params:{id_empresa:v.id,id_periodo:_}}).then(D=>{d.value=D.data,e.value=D.data})};return{refInputBuscar:g,dialogVisible:h,searchQuery:s,columns:P,partidas:d,filteredPartidas:e,filtrarPartidas:m,seleccionarPartida:F,cerrarDialogo:I,abrirDialogo:k}}}),ie=a=>(X("data-v-3ae10866"),a=a(),Z(),a),de=ie(()=>n("div",{class:"text-h6"},"Buscador",-1));function se(a,t,g,h,s,P){return M(),q(K,{modelValue:a.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=d=>a.dialogVisible=d),persistent:""},{default:o(()=>[l(H,{style:{"min-width":"600px"}},{default:o(()=>[l(le,null,{default:o(()=>[de,l(oe),l(y,{dense:"",flat:"",icon:"close",onClick:a.cerrarDialogo},null,8,["onClick"])]),_:1}),l($,null,{default:o(()=>[l(w,{modelValue:a.searchQuery,"onUpdate:modelValue":[t[0]||(t[0]=d=>a.searchQuery=d),a.filtrarPartidas],ref:"refInputBuscar",label:"Buscar partida",dense:"",outlined:"",clearable:"",debounce:"350"},{append:o(()=>[l(W,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),l(Y,{rows:a.filteredPartidas,columns:a.columns,"row-key":"correlativo",style:{height:"400px"},flat:"",bordered:"","virtual-scroll":"",separator:"cell","rows-per-page-options":[0],class:"my-sticky-header-table",onRowDblclick:a.seleccionarPartida,dense:""},{"body-cell-correlativo":o(d=>[l(p,{props:d},{default:o(()=>[O(S(d.row.correlativo),1)]),_:2},1032,["props"])]),"body-cell-nombre":o(d=>[l(p,{props:d},{default:o(()=>[O(S(d.row.nombre),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","onRowDblclick"])]),_:1})]),_:1},8,["modelValue"])}var ne=J(re,[["render",se],["__scopeId","data-v-3ae10866"]]);const U=new Date;U.setHours(0,-U.getTimezoneOffset(),0,0);let T=U.toJSON().slice(0,10);const ue=L({components:{BuscadorPartidas:ne},setup(){var z;const a=b(null),t=(z=V.getItem("user"))==null?void 0:z.toString(),g=b(0),h=[{name:"cuenta",label:"Cuenta",align:"left",field:"cuenta",sortable:!0,style:"width: 250px"},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion"},{name:"debe",label:"Debe",align:"right",field:"debe",style:"width: 150px"},{name:"haber",label:"Haber",align:"right",field:"haber",style:"width: 150px;"},{name:"acciones",label:"",field:"",align:"right",style:"width: 40px; padding:5px"}],s=b([{id:1,cuenta:"",descripcion:"",debe:0,haber:0}]),P=b([]),d=b([]),e=b({tipoPartida:"",idPartida:null,fecha:T,descripcion:"",operador:t}),m=b([{label:"Diario",value:"DR"},{label:"Ingreso",value:"ING"},{label:"Egreso",value:"EG"},{label:"Apertura",value:"APE"},{label:"Ajuste",value:"AJU"},{label:"Cierre",value:"cierre"}]),F=A(()=>s.value.reduce((r,i)=>r+(i.debe||0),0).toFixed(2)),I=A(()=>s.value.reduce((r,i)=>r+(i.haber||0),0).toFixed(2)),k=()=>{const i={id:(s.value.length===0?0:s.value.reduce((u,c)=>c.id>u?c.id:u,s.value[0].id))+1,cuenta:"",descripcion:"",debe:0,haber:0};s.value.push(i)},Q=r=>{s.value=s.value.filter(i=>i.id!==r)},v=(r=!1)=>{e.value={tipoPartida:r===!0?e.value.tipoPartida:"",idPartida:null,fecha:T,descripcion:"",operador:e.value.operador},s.value=[{id:1,cuenta:"",descripcion:"",debe:0,haber:0}]},_=()=>{let r=JSON.parse(V.getItem("empresa").toString());if(!V.getItem("periodo")){alert("Debe seleccionar un periodo antes de guardar la partida.");return}let u=V.getItem("periodo").toString();const c={_id_empresa:r.id,_tipo_poliza:e.value.tipoPartida,_fecha:e.value.fecha,_descripcion:e.value.descripcion,_usuario_opero:e.value.operador,_idperiodo:u,_usuario:t,_estado:"A",_detalles:s.value,_id_poliza:""};e.value.idPartida!==null&&e.value.idPartida!==""?(c._id_poliza=e.value.idPartida,C.put("partidamanual",c).then(f=>{alert("Partida actualizada correctamente")})):C.post("partidamanual",c).then(f=>{e.value.idPartida=f.data,alert("Partida generada correctamente")})},D=()=>{const r=V.getItem("empresa");if(r){const i=JSON.parse(r.toString());g.value=i.id}else{alert("Debe seleccionar una empresa");return}C.get("cuentasn4/combo?",{params:{id_empresa:g.value}}).then(i=>{P.value=i.data})},G=()=>{var r;(r=a.value)==null||r.abrirDialogo()},R=r=>{C.get("partidamanual/poliza",{params:{id_poliza:r}}).then(i=>{e.value.idPartida=r,e.value.tipoPartida=i.data.enc.tipo_poliza,e.value.operador=i.data.enc.usuario,e.value.descripcion=i.data.enc.descripcion,e.value.fecha=j(i.data.enc.fecha);let c=i.data.det.map(f=>({id:1,cuenta:{id:f.id_cuenta,nombre:f.descripcion,correlativo:f.correlativo_cuenta,descripcion:f.cuenta},descripcion:f.descripcion,debe:f.debe,haber:f.haber}));s.value=c})};function j(r){const i=new Date(r),u=i.getFullYear(),c=String(i.getMonth()+1).padStart(2,"0"),f=String(i.getDate()).padStart(2,"0");return`${u}-${c}-${f}`}return{refBuscadorPartida:a,columns:h,detallePartida:s,cuentasDisponibles:P,cuentasFilter:d,form:e,tiposPartida:m,totalDebe:F,totalHaber:I,agregarFila:k,eliminarFila:Q,nuevaPartida:v,guardarPartida:_,getCuentasn4:D,showBuscarPartida:G,onBuscarPartida:R,idEmpresa:g,getDatosPartida:()=>{console.log("buscar")},filterCuenta:(r,i)=>{if(r===""){i(()=>{d.value=P.value});return}i(()=>{const u=r.toLowerCase();d.value=P.value.filter(c=>isNaN(u)?c.descripcion.toLowerCase().includes(u.toLowerCase()):c.descripcion.toLowerCase().startsWith(u.toString()))},u=>{r!==""&&u.options.length>0&&(u.setOptionIndex(-1),u.moveOptionSelection(1,!0))})}}},mounted(){const a=V.getItem("empresa");if(!a)alert("Debe seleccionar una empresa antes de acceder a esta p\xE1gina."),this.$router.push("/");else{const t=JSON.parse(a.toString());this.idEmpresa=t.id,this.getCuentasn4()}}}),ce={class:"row q-col-gutter-sm"},pe={class:"col-6"},me={class:"col-5"},fe={class:"col-1"},be={class:"col-6"},ve={class:"col-6"},ge={class:"col-12"},he=n("div",{class:"col-12"},null,-1),Pe={class:"col-12 text-center q-pa-md q-gutter-md"},_e=n("strong",null,"Total:",-1),we={class:"row"},Ve={class:"col"},ye={class:"col text-right"},Ce={class:"text-subtitle1"};function Se(a,t,g,h,s,P){const d=x("buscador-partidas");return M(),q(te,{padding:""},{default:o(()=>[l(H,null,{default:o(()=>[l($,null,{default:o(()=>[l(ae,{onSubmit:ee(a.guardarPartida,["prevent"])},{default:o(()=>[n("div",ce,[n("div",pe,[l(N,{modelValue:a.form.tipoPartida,"onUpdate:modelValue":[t[0]||(t[0]=e=>a.form.tipoPartida=e),t[1]||(t[1]=e=>a.nuevaPartida(!0))],options:a.tiposPartida,label:"Tipo de Partida",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),n("div",me,[l(w,{modelValue:a.form.idPartida,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.idPartida=e),label:"Id Partida",outlined:"",dense:"",disable:""},null,8,["modelValue"])]),n("div",fe,[l(y,{color:"primary",outline:"",icon:"search",onClick:a.showBuscarPartida},null,8,["onClick"])]),n("div",be,[l(w,{modelValue:a.form.operador,"onUpdate:modelValue":t[3]||(t[3]=e=>a.form.operador=e),disable:"",label:"Oper\xF3",outlined:"",dense:""},null,8,["modelValue"])]),n("div",ve,[l(w,{modelValue:a.form.fecha,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.fecha=e),outlined:"",dense:"",type:"date",style:{"color-scheme":"dark"},clearable:""},null,8,["modelValue"])]),n("div",ge,[l(w,{modelValue:a.form.descripcion,"onUpdate:modelValue":t[5]||(t[5]=e=>a.form.descripcion=e),label:"Descripci\xF3n",outlined:"",dense:""},null,8,["modelValue"])]),he,n("div",Pe,[l(y,{label:"Guardar",color:"primary",push:"",class:"btn-fixed-width",onClick:a.guardarPartida},null,8,["onClick"]),l(y,{label:"Nueva Partida",color:"primary",flat:"",class:"btn-fixed-width2",onClick:t[6]||(t[6]=e=>a.nuevaPartida())})])])]),_:1},8,["onSubmit"])]),_:1}),l($,null,{default:o(()=>[l(Y,{style:{height:"400px"},bordered:"","virtual-scroll":"",separator:"cell","rows-per-page-options":[0],class:"my-sticky-header-table",rows:a.detallePartida,columns:a.columns,"row-key":"id",flat:"",dense:""},{"body-cell-cuenta":o(e=>[l(p,{props:e},{default:o(()=>[l(N,{modelValue:e.row.cuenta,"onUpdate:modelValue":m=>e.row.cuenta=m,options:a.cuentasFilter,"option-label":"descripcion","option-value":"correlativo",dense:"",outlined:"","map-options":"","hide-selected":"","hide-bottom-space":"","use-input":"","fill-input":"",clearable:"",onFilter:a.filterCuenta,onFilterAbort:()=>{}},null,8,["modelValue","onUpdate:modelValue","options","onFilter"])]),_:2},1032,["props"])]),"body-cell-descripcion":o(e=>[l(p,{props:e},{default:o(()=>[l(w,{modelValue:e.row.cuenta.nombre,"onUpdate:modelValue":m=>e.row.cuenta.nombre=m,dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-debe":o(e=>[l(p,{props:e},{default:o(()=>[l(w,{modelValue:e.row.debe,"onUpdate:modelValue":m=>e.row.debe=m,type:"number",dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-haber":o(e=>[l(p,{props:e},{default:o(()=>[l(w,{modelValue:e.row.haber,"onUpdate:modelValue":m=>e.row.haber=m,type:"number",dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acciones":o(e=>[l(p,{props:e},{default:o(()=>[l(y,{flat:"",round:"",icon:"delete",color:"negative",onClick:m=>a.eliminarFila(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),"bottom-row":o(()=>[l(B,null,{default:o(()=>[l(p),l(p,{class:"text-right"},{default:o(()=>[_e]),_:1}),l(p,{class:"text-right"},{default:o(()=>[n("strong",null,S(a.totalDebe),1)]),_:1}),l(p,{class:"text-right"},{default:o(()=>[n("strong",null,S(a.totalHaber),1)]),_:1}),l(p)]),_:1})]),bottom:o(e=>[l(B,{props:e,style:{width:"100%"}},{default:o(()=>[n("div",we,[n("div",Ve,[l(y,{flat:"",icon:"add",label:"Agregar Fila",onClick:a.agregarFila},null,8,["onClick"])]),n("div",ye,[n("div",Ce," Filas: "+S(a.detallePartida.length),1)])])]),_:2},1032,["props"])]),"no-data":o(e=>[l(B,{props:e},{default:o(()=>[l(p,{colspan:"100%"},{default:o(()=>[l(y,{flat:"",icon:"add",label:"Agregar Fila",onClick:a.agregarFila},null,8,["onClick"])]),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1}),l(d,{ref:"refBuscadorPartida",onPartidaSeleccionada:a.onBuscarPartida},null,8,["onPartidaSeleccionada"])]),_:1})}var Ae=J(ue,[["render",Se]]);export{Ae as default};
