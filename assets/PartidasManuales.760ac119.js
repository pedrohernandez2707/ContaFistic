import{h as $}from"./QSelect.70b07cba.js";import{d as T,g as v,_ as N,o as M,aF as q,w as t,e as a,l as _,i as B,j as h,C as J,aG as z,aH as C,Q as H,aM as R,bp as j,bq as K,f as s,P as S,q as A,r as W,aI as X}from"./index.e60fa00d.js";import{Q as Z}from"./QForm.b9c5a55d.js";import{Q as L,a as c}from"./QTable.bfefe082.js";import{Q as I}from"./QTr.42514221.js";import{Q as x}from"./QPage.b16c688f.js";import{a as y}from"./axios.a61b5a41.js";import{Q as ee,a as ae}from"./QBar.59ae0d55.js";import"./selection.21886ae7.js";import"./QList.5561c62f.js";const le=T({name:"BuscadorPartida",emits:["partida-seleccionada"],setup(e,{emit:r}){const w=v(null),n=v(!1),m=v(""),P=[{name:"poliza",label:"Poliza",align:"left",field:"id_poliza",sortable:!0},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion",sortable:!0}],o=v([]),l=v([...o.value]),p=()=>{m.value===null?l.value=o.value:l.value=o.value.filter(f=>f.id_poliza.toLowerCase().includes(m.value)||f.descripcion.toLowerCase().includes(m.value.toLowerCase()))},F=(f,V)=>{n.value=!1,r("partida-seleccionada",V.id_poliza)},D=()=>{n.value=!1},k=async()=>{var f;n.value=!0,await new Promise(V=>setTimeout(V,250)),(f=w.value)==null||f.focus(),Q()},Q=()=>{y.get("partidamanual",{params:{id_empresa:3,id_periodo:1}}).then(f=>{o.value=f.data,l.value=f.data})};return{refInputBuscar:w,dialogVisible:n,searchQuery:m,columns:P,partidas:o,filteredPartidas:l,filtrarPartidas:p,seleccionarPartida:F,cerrarDialogo:D,abrirDialogo:k}}}),oe=e=>(j("data-v-d00a8288"),e=e(),K(),e),te=oe(()=>s("div",{class:"text-h6"},"Buscador",-1));function ie(e,r,w,n,m,P){return M(),q(R,{modelValue:e.dialogVisible,"onUpdate:modelValue":r[1]||(r[1]=o=>e.dialogVisible=o),persistent:""},{default:t(()=>[a(H,{style:{"min-width":"600px"}},{default:t(()=>[a(ee,null,{default:t(()=>[te,a(ae),a(_,{dense:"",flat:"",icon:"close",onClick:e.cerrarDialogo},null,8,["onClick"])]),_:1}),a(B,null,{default:t(()=>[a(h,{modelValue:e.searchQuery,"onUpdate:modelValue":[r[0]||(r[0]=o=>e.searchQuery=o),e.filtrarPartidas],ref:"refInputBuscar",label:"Buscar partida",dense:"",outlined:"",clearable:"",debounce:"350"},{append:t(()=>[a(J,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),a(L,{rows:e.filteredPartidas,columns:e.columns,"row-key":"correlativo",style:{height:"400px"},flat:"",bordered:"","virtual-scroll":"",separator:"cell","rows-per-page-options":[0],class:"my-sticky-header-table",onRowDblclick:e.seleccionarPartida,dense:""},{"body-cell-correlativo":t(o=>[a(c,{props:o},{default:t(()=>[z(C(o.row.correlativo),1)]),_:2},1032,["props"])]),"body-cell-nombre":t(o=>[a(c,{props:o},{default:t(()=>[z(C(o.row.nombre),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","onRowDblclick"])]),_:1})]),_:1},8,["modelValue"])}var re=N(le,[["render",ie],["__scopeId","data-v-d00a8288"]]);const U=new Date;U.setHours(0,-U.getTimezoneOffset(),0,0);let O=U.toJSON().slice(0,10);const de=T({components:{BuscadorPartidas:re},setup(){const e=v(null),r=S.getItem("user"),w=[{name:"cuenta",label:"Cuenta",align:"left",field:"cuenta",sortable:!0,style:"width: 250px"},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion"},{name:"debe",label:"Debe",align:"right",field:"debe",style:"width: 150px"},{name:"haber",label:"Haber",align:"right",field:"haber",style:"width: 150px;"},{name:"acciones",label:"",field:"",align:"right",style:"width: 40px; padding:5px"}],n=v([{id:1,cuenta:"",descripcion:"",debe:0,haber:0}]),m=v([]),P=v([]),o=v({tipoPartida:"",idPartida:null,fecha:O,descripcion:"",operador:r}),l=v([{label:"Diario",value:"DR"},{label:"Ingreso",value:"ING"},{label:"Egreso",value:"EG"},{label:"Apertura",value:"APE"},{label:"Ajuste",value:"AJU"},{label:"Cierre",value:"cierre"}]),p=A(()=>n.value.reduce((i,d)=>i+parseFloat(d.debe||0),0).toFixed(2)),F=A(()=>n.value.reduce((i,d)=>i+parseFloat(d.haber||0),0).toFixed(2)),D=()=>{const d={id:(n.value.length===0?0:n.value.reduce((u,b)=>b.id>u?b.id:u,n.value[0].id))+1,cuenta:"",descripcion:"",debe:0,haber:0};n.value.push(d)},k=i=>{n.value=n.value.filter(d=>d.id!==i)},Q=(i=!1)=>{o.value={tipoPartida:i===!0?o.value.tipoPartida:"",idPartida:null,fecha:O,descripcion:"",operador:o.value.operador},n.value=[{id:1,cuenta:"",descripcion:"",debe:0,haber:0}]},f=()=>{let i=JSON.parse(S.getItem("empresa").toString()),d=S.getItem("periodo").toString();const u={_id_empresa:i.id,_tipo_poliza:o.value.tipoPartida,_fecha:o.value.fecha,_descripcion:o.value.descripcion,_usuario_opero:o.value.operador,_idperiodo:d,_usuario:r,_estado:"A",_detalles:n.value,_id_poliza:""};o.value.idPartida!==null&&o.value.idPartida!==""?(u._id_poliza=o.value.idPartida,y.put("partidamanual",u).then(b=>{alert("Partida actualizada correctamente")})):y.post("partidamanual",u).then(b=>{o.value.idPartida=b.data,alert("Partida generada correctamente")})},V=()=>{y.get("cuentasn4/combo").then(i=>{m.value=i.data})},Y=()=>{var i;(i=e.value)==null||i.abrirDialogo()},G=i=>{y.get("partidamanual/poliza",{params:{id_poliza:i}}).then(d=>{o.value.idPartida=i,o.value.tipoPartida=d.data.enc.tipo_poliza,o.value.operador=d.data.enc.usuario,o.value.descripcion=d.data.enc.descripcion,o.value.fecha=E(d.data.enc.fecha);let b=d.data.det.map(g=>({id:1,cuenta:{id:g.id_cuenta,nombre:g.descripcion,correlativo:g.correlativo_cuenta,descripcion:g.cuenta},descripcion:g.descripcion,debe:g.debe,haber:g.haber}));n.value=b})};function E(i){const d=new Date(i),u=d.getFullYear(),b=String(d.getMonth()+1).padStart(2,"0"),g=String(d.getDate()).padStart(2,"0");return`${u}-${b}-${g}`}return{refBuscadorPartida:e,columns:w,detallePartida:n,cuentasDisponibles:m,cuentasFilter:P,form:o,tiposPartida:l,totalDebe:p,totalHaber:F,agregarFila:D,eliminarFila:k,nuevaPartida:Q,guardarPartida:f,getCuentasn4:V,showBuscarPartida:Y,onBuscarPartida:G,getDatosPartida:()=>{console.log("buscar")},filterCuenta(i,d){if(i===""){d(()=>{P.value=m.value});return}d(()=>{const u=i.toLowerCase();P.value=m.value.filter(b=>b.descripcion.toLowerCase().indexOf(u)>-1)},u=>{i!==""&&u.options.length>0&&(u.setOptionIndex(-1),u.moveOptionSelection(1,!0))})}}},mounted(){this.getCuentasn4()}}),ne={class:"row q-col-gutter-sm"},se={class:"col-6"},ue={class:"col-5"},ce={class:"col-1"},pe={class:"col-6"},me={class:"col-6"},fe={class:"col-12"},be=s("div",{class:"col-12"},null,-1),ve={class:"col-12 text-center q-pa-md q-gutter-md"},ge=s("strong",null,"Total:",-1),he={class:"row"},Pe={class:"col"},_e={class:"col text-right"},we={class:"text-subtitle1"};function Ve(e,r,w,n,m,P){const o=W("buscador-partidas");return M(),q(x,{padding:""},{default:t(()=>[a(H,null,{default:t(()=>[a(B,null,{default:t(()=>[a(Z,{onSubmit:X(e.guardarPartida,["prevent"])},{default:t(()=>[s("div",ne,[s("div",se,[a($,{modelValue:e.form.tipoPartida,"onUpdate:modelValue":[r[0]||(r[0]=l=>e.form.tipoPartida=l),r[1]||(r[1]=l=>e.nuevaPartida(!0))],options:e.tiposPartida,label:"Tipo de Partida",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),s("div",ue,[a(h,{modelValue:e.form.idPartida,"onUpdate:modelValue":r[2]||(r[2]=l=>e.form.idPartida=l),label:"Id Partida",outlined:"",dense:"",disable:""},null,8,["modelValue"])]),s("div",ce,[a(_,{color:"primary",outline:"",icon:"search",onClick:e.showBuscarPartida},null,8,["onClick"])]),s("div",pe,[a(h,{modelValue:e.form.operador,"onUpdate:modelValue":r[3]||(r[3]=l=>e.form.operador=l),disable:"",label:"Oper\xF3",outlined:"",dense:""},null,8,["modelValue"])]),s("div",me,[a(h,{modelValue:e.form.fecha,"onUpdate:modelValue":r[4]||(r[4]=l=>e.form.fecha=l),outlined:"",dense:"",type:"date",style:{"color-scheme":"dark"},clearable:""},null,8,["modelValue"])]),s("div",fe,[a(h,{modelValue:e.form.descripcion,"onUpdate:modelValue":r[5]||(r[5]=l=>e.form.descripcion=l),label:"Descripci\xF3n",outlined:"",dense:""},null,8,["modelValue"])]),be,s("div",ve,[a(_,{label:"Guardar",color:"primary",push:"",class:"btn-fixed-width",onClick:e.guardarPartida},null,8,["onClick"]),a(_,{label:"Nueva Partida",color:"primary",flat:"",class:"btn-fixed-width2",onClick:e.nuevaPartida},null,8,["onClick"])])])]),_:1},8,["onSubmit"])]),_:1}),a(B,null,{default:t(()=>[a(L,{style:{height:"400px"},bordered:"","virtual-scroll":"",separator:"cell","rows-per-page-options":[0],class:"my-sticky-header-table",rows:e.detallePartida,columns:e.columns,"row-key":"id",flat:"",dense:""},{"body-cell-cuenta":t(l=>[a(c,{props:l},{default:t(()=>[a($,{modelValue:l.row.cuenta,"onUpdate:modelValue":p=>l.row.cuenta=p,options:e.cuentasFilter,"option-label":"descripcion","option-value":"correlativo",dense:"",outlined:"","map-options":"","hide-selected":"","hide-bottom-space":"","use-input":"","fill-input":"",clearable:"",onFilter:e.filterCuenta,onFilterAbort:()=>{}},null,8,["modelValue","onUpdate:modelValue","options","onFilter"])]),_:2},1032,["props"])]),"body-cell-descripcion":t(l=>[a(c,{props:l},{default:t(()=>[a(h,{modelValue:l.row.cuenta.nombre,"onUpdate:modelValue":p=>l.row.cuenta.nombre=p,dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-debe":t(l=>[a(c,{props:l},{default:t(()=>[a(h,{modelValue:l.row.debe,"onUpdate:modelValue":p=>l.row.debe=p,type:"number",dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-haber":t(l=>[a(c,{props:l},{default:t(()=>[a(h,{modelValue:l.row.haber,"onUpdate:modelValue":p=>l.row.haber=p,type:"number",dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acciones":t(l=>[a(c,{props:l},{default:t(()=>[a(_,{flat:"",round:"",icon:"delete",color:"negative",onClick:p=>e.eliminarFila(l.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),"bottom-row":t(()=>[a(I,null,{default:t(()=>[a(c),a(c,{class:"text-right"},{default:t(()=>[ge]),_:1}),a(c,{class:"text-right"},{default:t(()=>[s("strong",null,C(e.totalDebe),1)]),_:1}),a(c,{class:"text-right"},{default:t(()=>[s("strong",null,C(e.totalHaber),1)]),_:1}),a(c)]),_:1})]),bottom:t(l=>[a(I,{props:l,style:{width:"100%"}},{default:t(()=>[s("div",he,[s("div",Pe,[a(_,{flat:"",icon:"add",label:"Agregar Fila",onClick:e.agregarFila},null,8,["onClick"])]),s("div",_e,[s("div",we," Filas: "+C(e.detallePartida.length),1)])])]),_:2},1032,["props"])]),"no-data":t(l=>[a(I,{props:l},{default:t(()=>[a(c,{colspan:"100%"},{default:t(()=>[a(_,{flat:"",icon:"add",label:"Agregar Fila",onClick:e.agregarFila},null,8,["onClick"])]),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1}),a(o,{ref:"refBuscadorPartida",onPartidaSeleccionada:e.onBuscarPartida},null,8,["onPartidaSeleccionada"])]),_:1})}var ze=N(de,[["render",Ve]]);export{ze as default};
