import{a as Y,Q as Ne}from"./QBreadcrumbs.9d3bd4a9.js";import{d as re,g as d,_ as ie,o as de,aE as ce,w as l,e as a,k as C,i as G,j as I,B as O,aF as W,aG as _,Q as L,aL as Qe,bo as ue,bp as me,f as i,p as K,r as Pe,P as Ue,a as X,bk as Z,b9 as Ee,v as Q,ap as ee}from"./index.b32bed5e.js";import{h as P}from"./QSelect.a5d84a49.js";import{r as Be,u as $e,Q as ae,a as oe,b as Me}from"./xlsx.0041e740.js";import{Q as le,C as te}from"./ClosePopup.6a236885.js";import{Q as pe,a as u}from"./QTable.3d55a0b4.js";import{Q as j}from"./QTr.1888c913.js";import{Q as Ae}from"./QPage.fc1edd5b.js";import{a as U,s as S,b as ze,c as se}from"./axios.b40a6d52.js";import{Q as Je,a as Ye}from"./QBar.34d8f6c2.js";import"./selection.2848012d.js";import"./use-render-cache.3aae9b27.js";import"./QList.dfd7cb04.js";const je=re({name:"BuscadorCompras",emits:["compra-seleccionada"],setup(e,{emit:n}){const w=d(null),g=d(!1),V=d(""),k=[{name:"empresa",label:"Empresa",align:"left",field:"nombre_empresa",sortable:!0},{name:"compra",label:"Compra",align:"left",field:"id_compra",sortable:!0},{name:"poliza",label:"Poliza",align:"left",field:"id_poliza",sortable:!0},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion",sortable:!0}],c=d([]),o=d([...c.value]),v=()=>{V.value===null?o.value=c.value:o.value=c.value.filter(p=>p.id_compra.toLowerCase().includes(V.value)||p.descripcion||p.nombre_empresa||p.id_poliza.toLowerCase().includes(V.value.toLowerCase()))},E=(p,y)=>{g.value=!1,n("compra-seleccionada",y.id_compra)},D=()=>{g.value=!1},T=async()=>{var p;g.value=!0,await new Promise(y=>setTimeout(y,250)),(p=w.value)==null||p.focus(),B()},B=()=>{U.get("compras",{params:{id_empresa:3,id_periodo:1}}).then(p=>{c.value=p.data,o.value=p.data})};return{refInputBuscar:w,dialogVisible:g,searchQuery:V,columns:k,compras:c,filteredCompras:o,filtrarCompras:v,seleccionarCompra:E,cerrarDialogo:D,abrirDialogo:T}}}),Ge=e=>(ue("data-v-3d0f112b"),e=e(),me(),e),Oe=Ge(()=>i("div",{class:"text-h6"},"Buscador",-1));function Le(e,n,w,g,V,k){return de(),ce(Qe,{modelValue:e.dialogVisible,"onUpdate:modelValue":n[1]||(n[1]=c=>e.dialogVisible=c),persistent:""},{default:l(()=>[a(L,{style:{"min-width":"650px"}},{default:l(()=>[a(Je,null,{default:l(()=>[Oe,a(Ye),a(C,{dense:"",flat:"",icon:"close",onClick:e.cerrarDialogo},null,8,["onClick"])]),_:1}),a(G,null,{default:l(()=>[a(I,{modelValue:e.searchQuery,"onUpdate:modelValue":[n[0]||(n[0]=c=>e.searchQuery=c),e.filtrarCompras],ref:"refInputBuscar",label:"Buscar Libro Compras",dense:"",outlined:"",clearable:"",debounce:"350"},{append:l(()=>[a(O,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),a(pe,{rows:e.filteredCompras,columns:e.columns,"row-key":"correlativo",style:{height:"400px"},flat:"",bordered:"","virtual-scroll":"",separator:"cell","rows-per-page-options":[0],class:"my-sticky-header-table",onRowDblclick:e.seleccionarCompra,dense:""},{"body-cell-correlativo":l(c=>[a(u,{props:c},{default:l(()=>[W(_(c.row.correlativo),1)]),_:2},1032,["props"])]),"body-cell-nombre":l(c=>[a(u,{props:c},{default:l(()=>[W(_(c.row.nombre),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","onRowDblclick"])]),_:1})]),_:1},8,["modelValue"])}var Re=ie(je,[["render",Le],["__scopeId","data-v-3d0f112b"]]);const R=new Date;R.setHours(0,-R.getTimezoneOffset(),0,0);let ne=R.toJSON().slice(0,10).replaceAll("-","/");const qe=re({components:{BuscadorCompras:Re},setup(){const e=d(null),n=()=>{var s;(s=e.value)==null||s.abrirDialogo()},w=d([]),g=d(null),V=d(""),k=d(!1),c=d(""),o=d(""),v=()=>{U.get("/cuentasn4/QTable").then(s=>{w.value=s.data})},E=d(null),D=d(null),T=d(!1),B=d([{id:1,nombre:"2024"}]),p=d([{id:1,nombre:"Enero"},{id:2,nombre:"Febrero"},{id:3,nombre:"Marzo"},{id:4,nombre:"Abril"},{id:5,nombre:"Mayo"},{id:6,nombre:"Junio"},{id:7,nombre:"Julio"},{id:8,nombre:"Agosto"},{id:9,nombre:"Septiembre"},{id:10,nombre:"Octubre"},{id:11,nombre:"Noviembre"},{id:12,nombre:"Diciembre"}]),y=d(null),fe=d([]),be=d(!1),$=d(ne),M=d(ne),f=d([{}]),ve=[{name:"Doc",label:"Doc. No",field:"documento",align:"left"},{name:"Serie",label:"Serie",field:"serie",align:"left"},{name:"Fecha",label:"Fecha",field:"fecha",align:"left"},{name:"Tipo",label:"Tipo",field:"tipo",align:"left",style:"min-width:120px;max-width:120px;width:120px;"},{name:"Proveedor",label:"Proveedor",field:"proveedor",align:"left",style:"width: auto;"},{name:"NIT",label:"NIT",field:"nit",align:"left"},{name:"Cta",label:"Cta",field:"Cta",align:"left",style:"max-width:150px;width:150px"},{name:"check",label:"Factura Pagada",field:"checked",align:"center"},{name:"Importacion",label:"Importacion",field:"Importacion",align:"left"},{name:"Compras",label:"Compras",field:"Compras",align:"left"},{name:"Servicios",label:"Servicios",field:"Servicios",align:"left"},{name:"Exentos",label:"Exentos",field:"Exentos",align:"left"},{name:"Valor",label:"Valor",field:"Valor",align:"left"},{name:"Total",label:"Total",field:"total",align:"left"},{name:"Iva",label:"Iva",field:"iva",align:"left"},{name:"acciones",label:"",field:"",align:"right",style:"width: 40px; padding:5px"}],ge=s=>s.every(t=>t.Cta!==null),he=async()=>{let s=!1;const t=sessionStorage.getItem("empresa");let h=0;if(t)h=JSON.parse(t).id;else{S("Debe Seleccionar Empresa",{tipo:"negative"}),s=!0;return}const b=D.value;if(!b){S("Debe Seleccionar el Mes",{tipo:"negative"}),s=!0;return}const r=g.value;if(!r){S("Debe Seleccionar la Cuenta Contable Para el Encabezado",{tipo:"negative"}),s=!0;return}if(f.value.length==0){S("Debe Ingresar al Menos un Detalle",{tipo:"negative"}),s=!0;return}if(!ge(f.value)){S("Debe Indicar la cuenta contable para cada uno de los Detalles, verificar",{tipo:"negative"}),s=!0;return}let m=Ue.getItem("periodo");if(!m){S("Debe Seleccionar el Periodo para la Empresa Correspondiente",{tipo:"negative"}),s=!0;return}if(!s){if(!await ze("Confirmaci\xF3n","Esta seguro de Ingresar la Compra?",{}))return;const N={_encabezado:[{_id_Empresa:h,_mes:(b==null?void 0:b.id)||0,_periodo:m,_id_poliza:0,_id_cuenta_contable:r.id,_usuario_ingresa:"usrtest",_estado:"A"}],_detalle:f.value};console.log(N),X.show(),await U.post("/compras",N).then(De=>{const Te=De.data.fn_insertar_compras_json,[x,J]=Te.replace(/[()]/g,"").split(","),Fe=parseInt(x);J.replace(/"/g,""),S(`Compra guardada correctamente No.${x} Partida Generada ${J}`,{}),o.value=Fe.toString(),c.value=J.toString(),k.value=!0,T.value=!0}).finally(()=>{X.hide()})}},Ce=async()=>{if(y.value){const s=await y.value.arrayBuffer(),t=Be(s),h=t.Sheets[t.SheetNames[0]],r=$e.sheet_to_json(h).map(m=>({documento:m["N\xFAmero del DTE"],serie:m.Serie,fecha:Ve(m["Fecha de emisi\xF3n"]),tipo:m["Tipo de DTE (nombre)"],proveedor:m["Nombre completo del emisor"],nit:m["NIT del emisor"],total:m["Monto (Gran Total)"],iva:m["IVA (monto de este impuesto)"],Cta:null,checked:!1}));f.value=r}return 0},A=d("eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJBZ2VuY2lhVmlydHVhbERURSIsImlzcyI6IlNBVCIsIm5pdCI6IjEwNDkwOTUwMSIsImV4cCI6MTcyNTY0MTk1MywiaWF0IjoxNzI1NTk4NzUzfQ.2KE72Se31MWfXb3hVNJhluyAh2Fn6Vw-puz7UwbPoTk"),_e=()=>{const s=se.create();A.value===""&&(console.log("Hacer login sat"),s.get("http://localhost:5000/get-token").then(t=>{console.log(t.data),A.value=t.data}).catch(t=>console.error("Error:",t)))};function Ve(s){const t=new Date(s),h=t.getFullYear(),b=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),m=String(t.getHours()).padStart(2,"0"),z=String(t.getMinutes()).padStart(2,"0"),N=String(t.getSeconds()).padStart(2,"0");return`${h}-${b}-${r} ${m}:${z}:${N}`}const F=s=>{const[t,h,b]=s.split("/").map(Number),r=b.toString().padStart(2,"0"),m=h.toString().padStart(2,"0");return`${r}-${m}-${t}`},we=()=>{const s=se.create();console.log(F($.value),F(M.value)),s.get("http://localhost:5000/get-fact",{headers:{Authorization:A.value},params:{nit:"104909501",fechai:F($.value),fechaf:F(M.value),tipo:"R"}}).then(t=>{const b=t.data.data.map(r=>({documento:r.numeroDocumento,serie:r.serie,fecha:r.fechaEmision,tipo:r.tipo,proveedor:r.nombreEmisor,nit:r.nitEmisor,total:r.granTotal,iva:r.totalIva}));f.value=b}).catch(t=>console.error("Error:",t))},ye=s=>{f.value=f.value.filter(t=>t.documento!==s)},Se=()=>{f.value.push({documento:f.value.length+1})},Ie=K(()=>f.value.reduce((s,t)=>s+parseFloat(t.total||0),0).toFixed(2)),ke=K(()=>f.value.reduce((s,t)=>s+parseFloat(t.iva||0),0).toFixed(2));function H(s){const t=s.replace(/[\$,]/g,"");return parseFloat(t)}return{onBuscarCompra:s=>{U.get("compras/idCompra",{params:{id_compra:s}}).then(t=>{o.value=s,D.value=t.data.enc.id_periodo,g.value=t.data.enc.id_cuenta_contable,c.value=t.data.enc.id_poliza;let b=t.data.det.map(r=>({id:1,Cta:{id:r.id_cuenta,nombre:r.nombre},documento:r.doc_no,serie:r.serie,fecha:r.fecha,tipo:r.tipo_documento,proveedor:r.proveedor,nit:r.nit_cedula,checked:!1,Importacion:r.importaciones,Servicios:r.servicios,Exentos:r.exentos,Valor:r.valor,total:H(r.total),iva:H(r.iva)}));f.value=b})},file:y,parsedCSV:fe,visibleDate:be,fechai:$,fechaf:M,convert:Ce,columns:ve,compras:f,getdata:_e,getFacturas:we,eliminarFila:ye,agregarFila:Se,calculoTotal:Ie,calculoIva:ke,onClick:he,selectedCuentaEnc:g,cuentasn4:w,getCuentasN4:v,cantFacturas:V,txtNoPartida:c,checkPartidaGenerada:k,txtNoCompra:o,mesesDelA\u00F1o:p,periodoModel:E,mesesModel:D,periodos:B,disableBTN:T,showBuscarCompra:n,refBuscadorCompra:e}},mounted(){this.getdata(),this.getCuentasN4()}}),q=e=>(ue("data-v-2b8762b4"),e=e(),me(),e),He={class:"row q-col-gutter-sm"},xe={class:"col-4"},We={class:"col-4"},Ke={class:"col-1"},Xe={class:"col-4"},Ze={class:"col-2"},ea={class:"col-2 text-center"},aa={class:"col-3"},oa={class:"col-12"},la={class:"col-12"},ta={class:"row q-col-gutter-sm"},sa={class:"col-5"},na={class:"row items-center justify-end"},ra={class:"col-5"},ia={class:"row items-center justify-end"},da={class:"col-2"},ca={class:"col-12"},ua={class:"row q-ma-sm"},ma=q(()=>i("div",{class:"col-9"},[i("div",{class:"text-h6"},"Detalle de Compras")],-1)),pa=q(()=>i("div",{class:"col-1"},null,-1)),fa={class:"col"},ba=q(()=>i("strong",null,"Totales:",-1));function va(e,n,w,g,V,k){const c=Pe("buscador-compras");return de(),ce(Ae,{padding:""},{default:l(()=>[a(Ne,null,{default:l(()=>[a(Y,{label:"Registros Contables",icon:"paid"}),a(Y,{label:"Ingreso",icon:"input"}),a(Y,{label:"Libro Compras",icon:"shopping_bag"})]),_:1}),a(L,{class:"q-mt-md"},{default:l(()=>[a(G,null,{default:l(()=>[i("div",He,[i("div",xe,[a(I,{modelValue:e.txtNoCompra,"onUpdate:modelValue":n[0]||(n[0]=o=>e.txtNoCompra=o),type:"text",label:"No. Interno",outlined:"",dense:"",disable:!0},null,8,["modelValue"])]),i("div",We,[a(P,{modelValue:e.mesesModel,"onUpdate:modelValue":n[1]||(n[1]=o=>e.mesesModel=o),options:e.mesesDelA\u00F1o,label:"Mes",outlined:"",dense:"","option-value":"id","option-label":"nombre"},null,8,["modelValue","options"])]),i("div",Ke,[a(C,{color:"primary",outline:"",icon:"search",onClick:e.showBuscarCompra},null,8,["onClick"])]),i("div",Xe,[a(P,{modelValue:e.selectedCuentaEnc,"onUpdate:modelValue":n[2]||(n[2]=o=>e.selectedCuentaEnc=o),options:e.cuentasn4,label:"Cuenta Haber",outlined:"",dense:"","option-value":"id","option-label":"nombre"},null,8,["modelValue","options"])]),i("div",Ze,[a(I,{modelValue:e.cantFacturas,"onUpdate:modelValue":n[3]||(n[3]=o=>e.cantFacturas=o),type:"text",label:"Cant. Facturas",outlined:"",dense:"",disable:!0},null,8,["modelValue"])]),i("div",ea,[a(Z,{"left-label":"",modelValue:e.checkPartidaGenerada,"onUpdate:modelValue":n[4]||(n[4]=o=>e.checkPartidaGenerada=o),label:"Partida generada",disable:!0},null,8,["modelValue"])]),i("div",aa,[a(I,{modelValue:e.txtNoPartida,"onUpdate:modelValue":n[5]||(n[5]=o=>e.txtNoPartida=o),type:"text",label:"No.Partida",outlined:"",dense:"",disable:!0},null,8,["modelValue"])]),i("div",oa,[a(Ee,{modelValue:e.visibleDate,"onUpdate:modelValue":n[6]||(n[6]=o=>e.visibleDate=o),label:"Consultar SAT"},null,8,["modelValue"])]),i("div",la,[a(le,null,{default:l(()=>[Q(i("div",ta,[i("div",sa,[a(I,{dense:"",outlined:"",modelValue:e.fechai,"onUpdate:modelValue":n[8]||(n[8]=o=>e.fechai=o),mask:"date",rules:["date"],label:"Fecha Inicial","hide-bottom-space":"",placeholder:"YYYY/MM/DD",clearable:""},{append:l(()=>[a(O,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(ae,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(oe,{modelValue:e.fechai,"onUpdate:modelValue":n[7]||(n[7]=o=>e.fechai=o)},{default:l(()=>[i("div",na,[Q(a(C,{label:"Cerrar",color:"primary",flat:""},null,512),[[te]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),i("div",ra,[a(I,{dense:"",outlined:"",modelValue:e.fechaf,"onUpdate:modelValue":n[10]||(n[10]=o=>e.fechaf=o),mask:"date",rules:["date"],"hide-bottom-space":"",label:"Fecha Final",placeholder:"YYYY/MM/DD",clearable:""},{append:l(()=>[a(O,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(ae,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(oe,{modelValue:e.fechaf,"onUpdate:modelValue":n[9]||(n[9]=o=>e.fechaf=o)},{default:l(()=>[i("div",ia,[Q(a(C,{label:"Cerrar",color:"primary",flat:""},null,512),[[te]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),i("div",da,[a(C,{color:"primary",label:"Consultar",onClick:e.getFacturas},null,8,["onClick"])])],512),[[ee,e.visibleDate]])]),_:1})]),i("div",ca,[a(le,null,{default:l(()=>[Q(a(Me,{modelValue:e.file,"onUpdate:modelValue":[n[11]||(n[11]=o=>e.file=o),e.convert],label:"Seleccione o arraste un archivo para importar(.xls)",outlined:"",accept:".xls",clearable:""},null,8,["modelValue","onUpdate:modelValue"]),[[ee,!e.visibleDate]])]),_:1})])])]),_:1})]),_:1}),a(L,{class:"q-mt-sm"},{default:l(()=>[a(G,{class:"q-pt-none"},{default:l(()=>[i("div",ua,[ma,pa,i("div",fa,[a(C,{color:"primary",icon:"check",label:e.txtNoCompra?"Actualizar Partida":"Generar Partida",onClick:e.onClick,disable:e.disableBTN},null,8,["label","onClick","disable"])])]),a(pe,{style:{height:"400px"},flat:"",bordered:"","virtual-scroll":"",separator:"cell","rows-per-page-options":[0],class:"my-sticky-header-table",rows:e.compras,columns:e.columns,"row-key":"id",dense:""},{"body-cell-Tipo":l(o=>[a(u,{props:o},{default:l(()=>[a(P,{modelValue:o.row.tipo,"onUpdate:modelValue":v=>o.row.tipo=v,options:[{label:"Factura",value:"FACT"},{label:"Cambiaria",value:"FCAM"},{label:"NC",value:"NCRE"}],borderless:"",dense:"","options-dense":"","map-options":"",class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell":l(o=>[a(u,{props:o},{default:l(()=>[a(I,{modelValue:o.row[o.col.field],"onUpdate:modelValue":v=>o.row[o.col.field]=v,"input-class":"text-right",dense:"",borderless:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-Cta":l(o=>[a(u,{props:o},{default:l(()=>[a(P,{modelValue:o.row.Cta,"onUpdate:modelValue":v=>o.row.Cta=v,options:e.cuentasn4,borderless:"",dense:"","options-dense":"","use-input":"","input-debounce":"0",class:"custom-select","option-value":"id","option-label":"nombre",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["props"])]),"body-cell-check":l(o=>[a(u,{props:o,align:"center"},{default:l(()=>[a(Z,{modelValue:o.row.checked,"onUpdate:modelValue":v=>o.row.checked=v,color:"primary",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acciones":l(o=>[a(u,{props:o},{default:l(()=>[a(C,{flat:"",round:"",icon:"delete",color:"negative",onClick:v=>e.eliminarFila(o.row.documento)},null,8,["onClick"])]),_:2},1032,["props"])]),"bottom-row":l(()=>[a(j,null,{default:l(()=>[a(u,{colspan:"7",class:"text-right"}),a(u,{class:"text-right"},{default:l(()=>[ba]),_:1}),a(u,{class:"text-right"},{default:l(()=>[i("strong",null,_(e.calculoTotal),1)]),_:1}),a(u,{class:"text-right"},{default:l(()=>[i("strong",null,_(e.calculoTotal),1)]),_:1}),a(u,{class:"text-right"},{default:l(()=>[i("strong",null,_(e.calculoTotal),1)]),_:1}),a(u,{class:"text-right"},{default:l(()=>[i("strong",null,_(e.calculoTotal),1)]),_:1}),a(u,{class:"text-right"},{default:l(()=>[i("strong",null,_(e.calculoTotal),1)]),_:1}),a(u,{class:"text-right"},{default:l(()=>[i("strong",null,_(e.calculoTotal),1)]),_:1}),a(u,{class:"text-right"},{default:l(()=>[i("strong",null,_(e.calculoIva),1)]),_:1})]),_:1})]),bottom:l(o=>[a(j,{props:o},{default:l(()=>[a(u,{colspan:"100%"},{default:l(()=>[a(C,{flat:"",icon:"add",label:"Agregar Fila",onClick:e.agregarFila},null,8,["onClick"])]),_:1})]),_:2},1032,["props"])]),"no-data":l(o=>[a(j,{props:o},{default:l(()=>[a(u,{colspan:"100%"},{default:l(()=>[a(C,{flat:"",icon:"add",label:"Agregar Fila",onClick:e.agregarFila},null,8,["onClick"])]),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1}),a(c,{ref:"refBuscadorCompra",onCompraSeleccionada:e.onBuscarCompra},null,8,["onCompraSeleccionada"])]),_:1})}var Qa=ie(qe,[["render",va],["__scopeId","data-v-2b8762b4"]]);export{Qa as default};
