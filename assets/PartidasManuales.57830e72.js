import{h as A}from"./QSelect.050ad78f.js";import{d as q,g as v,_ as E,P as C,o as H,aF as L,w as t,e as a,l as w,i as U,j as P,C as j,aG as O,aH as D,Q as Y,aM as K,bp as W,bq as X,f as s,q as N,r as Z,aI as x}from"./index.9bc9c606.js";import{Q as ee}from"./QForm.4bf59d6e.js";import{Q as G,a as c}from"./QTable.9127dbc9.js";import{Q as B}from"./QTr.c3fe0244.js";import{Q as ae}from"./QPage.aeec985c.js";import{s as T,a as y}from"./axios.815799b5.js";import{Q as le,a as oe}from"./QBar.ccc8470d.js";import"./selection.fe184fa4.js";import"./QList.26b4c007.js";const te=q({name:"BuscadorPartida",emits:["partida-seleccionada"],setup(e,{emit:i}){const V=v(null),n=v(!1),m=v(""),_=[{name:"poliza",label:"Poliza",align:"left",field:"id_poliza",sortable:!0},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion",sortable:!0}],o=v([]),l=v([...o.value]),p=()=>{m.value===null?l.value=o.value:l.value=o.value.filter(f=>f.id_poliza.toLowerCase().includes(m.value)||f.descripcion.toLowerCase().includes(m.value.toLowerCase()))},F=(f,h)=>{n.value=!1,i("partida-seleccionada",h.id_poliza)},Q=()=>{n.value=!1},k=async()=>{var f;n.value=!0,await new Promise(h=>setTimeout(h,250)),(f=V.value)==null||f.focus(),I()},I=()=>{let f=JSON.parse(C.getItem("empresa").toString());if(!f.id){T("Debe Seleccionar la Empresa",{tipo:"negative"});return}let h=C.getItem("periodo");if(!h){T("Debe Seleccionar el Periodo para la Empresa Correspondiente",{tipo:"negative"});return}y.get("partidamanual",{params:{id_empresa:f.id,id_periodo:h}}).then(S=>{o.value=S.data,l.value=S.data})};return{refInputBuscar:V,dialogVisible:n,searchQuery:m,columns:_,partidas:o,filteredPartidas:l,filtrarPartidas:p,seleccionarPartida:F,cerrarDialogo:Q,abrirDialogo:k}}}),ie=e=>(W("data-v-3ae10866"),e=e(),X(),e),re=ie(()=>s("div",{class:"text-h6"},"Buscador",-1));function de(e,i,V,n,m,_){return H(),L(K,{modelValue:e.dialogVisible,"onUpdate:modelValue":i[1]||(i[1]=o=>e.dialogVisible=o),persistent:""},{default:t(()=>[a(Y,{style:{"min-width":"600px"}},{default:t(()=>[a(le,null,{default:t(()=>[re,a(oe),a(w,{dense:"",flat:"",icon:"close",onClick:e.cerrarDialogo},null,8,["onClick"])]),_:1}),a(U,null,{default:t(()=>[a(P,{modelValue:e.searchQuery,"onUpdate:modelValue":[i[0]||(i[0]=o=>e.searchQuery=o),e.filtrarPartidas],ref:"refInputBuscar",label:"Buscar partida",dense:"",outlined:"",clearable:"",debounce:"350"},{append:t(()=>[a(j,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),a(G,{rows:e.filteredPartidas,columns:e.columns,"row-key":"correlativo",style:{height:"400px"},flat:"",bordered:"","virtual-scroll":"",separator:"cell","rows-per-page-options":[0],class:"my-sticky-header-table",onRowDblclick:e.seleccionarPartida,dense:""},{"body-cell-correlativo":t(o=>[a(c,{props:o},{default:t(()=>[O(D(o.row.correlativo),1)]),_:2},1032,["props"])]),"body-cell-nombre":t(o=>[a(c,{props:o},{default:t(()=>[O(D(o.row.nombre),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","onRowDblclick"])]),_:1})]),_:1},8,["modelValue"])}var ne=E(te,[["render",de],["__scopeId","data-v-3ae10866"]]);const $=new Date;$.setHours(0,-$.getTimezoneOffset(),0,0);let M=$.toJSON().slice(0,10);const se=q({components:{BuscadorPartidas:ne},setup(){var z;const e=v(null),i=(z=C.getItem("user"))==null?void 0:z.toString(),V=[{name:"cuenta",label:"Cuenta",align:"left",field:"cuenta",sortable:!0,style:"width: 250px"},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion"},{name:"debe",label:"Debe",align:"right",field:"debe",style:"width: 150px"},{name:"haber",label:"Haber",align:"right",field:"haber",style:"width: 150px;"},{name:"acciones",label:"",field:"",align:"right",style:"width: 40px; padding:5px"}],n=v([{id:1,cuenta:"",descripcion:"",debe:0,haber:0}]),m=v([]),_=v([]),o=v({tipoPartida:"",idPartida:null,fecha:M,descripcion:"",operador:i}),l=v([{label:"Diario",value:"DR"},{label:"Ingreso",value:"ING"},{label:"Egreso",value:"EG"},{label:"Apertura",value:"APE"},{label:"Ajuste",value:"AJU"},{label:"Cierre",value:"cierre"}]),p=N(()=>n.value.reduce((r,d)=>r+(d.debe||0),0).toFixed(2)),F=N(()=>n.value.reduce((r,d)=>r+(d.haber||0),0).toFixed(2)),Q=()=>{const d={id:(n.value.length===0?0:n.value.reduce((u,b)=>b.id>u?b.id:u,n.value[0].id))+1,cuenta:"",descripcion:"",debe:0,haber:0};n.value.push(d)},k=r=>{n.value=n.value.filter(d=>d.id!==r)},I=(r=!1)=>{o.value={tipoPartida:r===!0?o.value.tipoPartida:"",idPartida:null,fecha:M,descripcion:"",operador:o.value.operador},n.value=[{id:1,cuenta:"",descripcion:"",debe:0,haber:0}]},f=()=>{let r=JSON.parse(C.getItem("empresa").toString()),d=C.getItem("periodo").toString();const u={_id_empresa:r.id,_tipo_poliza:o.value.tipoPartida,_fecha:o.value.fecha,_descripcion:o.value.descripcion,_usuario_opero:o.value.operador,_idperiodo:d,_usuario:i,_estado:"A",_detalles:n.value,_id_poliza:""};o.value.idPartida!==null&&o.value.idPartida!==""?(u._id_poliza=o.value.idPartida,y.put("partidamanual",u).then(b=>{alert("Partida actualizada correctamente")})):y.post("partidamanual",u).then(b=>{o.value.idPartida=b.data,alert("Partida generada correctamente")})},h=()=>{y.get("cuentasn4/combo").then(r=>{m.value=r.data})},S=()=>{var r;(r=e.value)==null||r.abrirDialogo()},J=r=>{y.get("partidamanual/poliza",{params:{id_poliza:r}}).then(d=>{o.value.idPartida=r,o.value.tipoPartida=d.data.enc.tipo_poliza,o.value.operador=d.data.enc.usuario,o.value.descripcion=d.data.enc.descripcion,o.value.fecha=R(d.data.enc.fecha);let b=d.data.det.map(g=>({id:1,cuenta:{id:g.id_cuenta,nombre:g.descripcion,correlativo:g.correlativo_cuenta,descripcion:g.cuenta},descripcion:g.descripcion,debe:g.debe,haber:g.haber}));n.value=b})};function R(r){const d=new Date(r),u=d.getFullYear(),b=String(d.getMonth()+1).padStart(2,"0"),g=String(d.getDate()).padStart(2,"0");return`${u}-${b}-${g}`}return{refBuscadorPartida:e,columns:V,detallePartida:n,cuentasDisponibles:m,cuentasFilter:_,form:o,tiposPartida:l,totalDebe:p,totalHaber:F,agregarFila:Q,eliminarFila:k,nuevaPartida:I,guardarPartida:f,getCuentasn4:h,showBuscarPartida:S,onBuscarPartida:J,getDatosPartida:()=>{console.log("buscar")},filterCuenta(r,d){if(r===""){d(()=>{_.value=m.value});return}d(()=>{const u=r.toLowerCase();_.value=m.value.filter(b=>b.descripcion.toLowerCase().indexOf(u)>-1)},u=>{r!==""&&u.options.length>0&&(u.setOptionIndex(-1),u.moveOptionSelection(1,!0))})}}},mounted(){this.getCuentasn4()}}),ue={class:"row q-col-gutter-sm"},ce={class:"col-6"},pe={class:"col-5"},me={class:"col-1"},fe={class:"col-6"},be={class:"col-6"},ve={class:"col-12"},ge=s("div",{class:"col-12"},null,-1),he={class:"col-12 text-center q-pa-md q-gutter-md"},Pe=s("strong",null,"Total:",-1),_e={class:"row"},we={class:"col"},Ve={class:"col text-right"},ye={class:"text-subtitle1"};function Ce(e,i,V,n,m,_){const o=Z("buscador-partidas");return H(),L(ae,{padding:""},{default:t(()=>[a(Y,null,{default:t(()=>[a(U,null,{default:t(()=>[a(ee,{onSubmit:x(e.guardarPartida,["prevent"])},{default:t(()=>[s("div",ue,[s("div",ce,[a(A,{modelValue:e.form.tipoPartida,"onUpdate:modelValue":[i[0]||(i[0]=l=>e.form.tipoPartida=l),i[1]||(i[1]=l=>e.nuevaPartida(!0))],options:e.tiposPartida,label:"Tipo de Partida",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),s("div",pe,[a(P,{modelValue:e.form.idPartida,"onUpdate:modelValue":i[2]||(i[2]=l=>e.form.idPartida=l),label:"Id Partida",outlined:"",dense:"",disable:""},null,8,["modelValue"])]),s("div",me,[a(w,{color:"primary",outline:"",icon:"search",onClick:e.showBuscarPartida},null,8,["onClick"])]),s("div",fe,[a(P,{modelValue:e.form.operador,"onUpdate:modelValue":i[3]||(i[3]=l=>e.form.operador=l),disable:"",label:"Oper\xF3",outlined:"",dense:""},null,8,["modelValue"])]),s("div",be,[a(P,{modelValue:e.form.fecha,"onUpdate:modelValue":i[4]||(i[4]=l=>e.form.fecha=l),outlined:"",dense:"",type:"date",style:{"color-scheme":"dark"},clearable:""},null,8,["modelValue"])]),s("div",ve,[a(P,{modelValue:e.form.descripcion,"onUpdate:modelValue":i[5]||(i[5]=l=>e.form.descripcion=l),label:"Descripci\xF3n",outlined:"",dense:""},null,8,["modelValue"])]),ge,s("div",he,[a(w,{label:"Guardar",color:"primary",push:"",class:"btn-fixed-width",onClick:e.guardarPartida},null,8,["onClick"]),a(w,{label:"Nueva Partida",color:"primary",flat:"",class:"btn-fixed-width2",onClick:i[6]||(i[6]=l=>e.nuevaPartida())})])])]),_:1},8,["onSubmit"])]),_:1}),a(U,null,{default:t(()=>[a(G,{style:{height:"400px"},bordered:"","virtual-scroll":"",separator:"cell","rows-per-page-options":[0],class:"my-sticky-header-table",rows:e.detallePartida,columns:e.columns,"row-key":"id",flat:"",dense:""},{"body-cell-cuenta":t(l=>[a(c,{props:l},{default:t(()=>[a(A,{modelValue:l.row.cuenta,"onUpdate:modelValue":p=>l.row.cuenta=p,options:e.cuentasFilter,"option-label":"descripcion","option-value":"correlativo",dense:"",outlined:"","map-options":"","hide-selected":"","hide-bottom-space":"","use-input":"","fill-input":"",clearable:"",onFilter:e.filterCuenta,onFilterAbort:()=>{}},null,8,["modelValue","onUpdate:modelValue","options","onFilter"])]),_:2},1032,["props"])]),"body-cell-descripcion":t(l=>[a(c,{props:l},{default:t(()=>[a(P,{modelValue:l.row.cuenta.nombre,"onUpdate:modelValue":p=>l.row.cuenta.nombre=p,dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-debe":t(l=>[a(c,{props:l},{default:t(()=>[a(P,{modelValue:l.row.debe,"onUpdate:modelValue":p=>l.row.debe=p,type:"number",dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-haber":t(l=>[a(c,{props:l},{default:t(()=>[a(P,{modelValue:l.row.haber,"onUpdate:modelValue":p=>l.row.haber=p,type:"number",dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acciones":t(l=>[a(c,{props:l},{default:t(()=>[a(w,{flat:"",round:"",icon:"delete",color:"negative",onClick:p=>e.eliminarFila(l.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),"bottom-row":t(()=>[a(B,null,{default:t(()=>[a(c),a(c,{class:"text-right"},{default:t(()=>[Pe]),_:1}),a(c,{class:"text-right"},{default:t(()=>[s("strong",null,D(e.totalDebe),1)]),_:1}),a(c,{class:"text-right"},{default:t(()=>[s("strong",null,D(e.totalHaber),1)]),_:1}),a(c)]),_:1})]),bottom:t(l=>[a(B,{props:l,style:{width:"100%"}},{default:t(()=>[s("div",_e,[s("div",we,[a(w,{flat:"",icon:"add",label:"Agregar Fila",onClick:e.agregarFila},null,8,["onClick"])]),s("div",Ve,[s("div",ye," Filas: "+D(e.detallePartida.length),1)])])]),_:2},1032,["props"])]),"no-data":t(l=>[a(B,{props:l},{default:t(()=>[a(c,{colspan:"100%"},{default:t(()=>[a(w,{flat:"",icon:"add",label:"Agregar Fila",onClick:e.agregarFila},null,8,["onClick"])]),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1}),a(o,{ref:"refBuscadorPartida",onPartidaSeleccionada:e.onBuscarPartida},null,8,["onPartidaSeleccionada"])]),_:1})}var Oe=E(se,[["render",Ce]]);export{Oe as default};
