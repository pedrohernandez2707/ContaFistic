import{a as M,Q as ve}from"./QBreadcrumbs.e7843302.js";import{_ as he,U as Ve,r,c as Y,V as Ce,aB as _e,a1 as o,a as j,Z as a,a4 as O,$ as s,a5 as h,bh as we,b6 as Se,w,ak as G,Q as q,a6 as g,a2 as H,aD as v,bl as ye,bm as Ie}from"./index.636087c0.js";import{d as C}from"./QList.e1b348f8.js";import{r as Te,u as Fe,Q as R,a as W,C as K,b as De}from"./xlsx.6af41f6a.js";import{Q as L}from"./QSlideTransition.455ad2fd.js";import{Q as Ne,a as c}from"./QTable.ba9f47a7.js";import{Q as E}from"./QTr.56d0e9e6.js";import{Q as ke}from"./QPage.1f755c2f.js";import{a as X}from"./axios.bf56c3c5.js";import{a as Z,s as V,b as Qe}from"./axios.502daeff.js";import"./selection.5fba8b9b.js";import"./use-render-cache.3aae9b27.js";const P=new Date;P.setHours(0,-P.getTimezoneOffset(),0,0);let x=P.toJSON().slice(0,10).replaceAll("-","/");const Ue=Ve({setup(){const e=r([]),n=r(null),$=r(""),S=r(!1),y=r(""),I=r(""),l=()=>{Z.get("/cuentasn4/QTable").then(i=>{e.value=i.data})},b=r(null),z=r(null),B=r(!1),ee=r([{id:1,nombre:"2024"}]),ae=r([{id:1,nombre:"Enero"},{id:2,nombre:"Febrero"},{id:3,nombre:"Marzo"},{id:4,nombre:"Abril"},{id:5,nombre:"Mayo"},{id:6,nombre:"Junio"},{id:7,nombre:"Julio"},{id:8,nombre:"Agosto"},{id:9,nombre:"Septiembre"},{id:10,nombre:"Octubre"},{id:11,nombre:"Noviembre"},{id:12,nombre:"Diciembre"}]),T=r(null),le=r([]),oe=r(!1),F=r(x),D=r(x),m=r([{}]),te=[{name:"Doc",label:"Doc. No",field:"documento",align:"left"},{name:"Serie",label:"Serie",field:"serie",align:"left"},{name:"Fecha",label:"Fecha",field:"fecha",align:"left"},{name:"Tipo",label:"Tipo",field:"tipo",align:"left",style:"min-width:120px;max-width:120px;width:120px;"},{name:"Proveedor",label:"Proveedor",field:"proveedor",align:"left",style:"width: auto;"},{name:"NIT",label:"NIT",field:"nit",align:"left"},{name:"Cta",label:"Cta",field:"Cta",align:"left",style:"max-width:150px;width:150px"},{name:"Importacion",label:"Importacion",field:"Importacion",align:"left"},{name:"Compras",label:"Compras",field:"Compras",align:"left"},{name:"Servicios",label:"Servicios",field:"Servicios",align:"left"},{name:"Exentos",label:"Exentos",field:"Exentos",align:"left"},{name:"Valor",label:"Valor",field:"Valor",align:"left"},{name:"Total",label:"Total",field:"total",align:"left"},{name:"Iva",label:"Iva",field:"iva",align:"left"},{name:"acciones",label:"",field:"",align:"right",style:"width: 40px; padding:5px"}],se=i=>i.every(t=>t.Cta!==null),ne=async()=>{let i=!1;const t=sessionStorage.getItem("empresa");let f=0;if(t)f=JSON.parse(t).id;else{V("Debe Seleccionar Empresa",{tipo:"negative"}),i=!0;return}const p=z.value;if(!p){V("Debe Seleccionar el Mes",{tipo:"negative"}),i=!0;return}const d=n.value;if(!d){V("Debe Seleccionar la Cuenta Contable Para el Encabezado",{tipo:"negative"}),i=!0;return}if(m.value.length==0){V("Debe Ingresar al Menos un Detalle",{tipo:"negative"}),i=!0;return}if(!se(m.value)){V("Debe Indicar la cuenta contable para cada uno de los Detalles, verificar",{tipo:"negative"}),i=!0;return}if(!i){if(!await Qe("Confirmaci\xF3n","Esta seguro de Ingresar la Compra?",{}))return;const k={_encabezado:[{_id_Empresa:f,_mes:(p==null?void 0:p.id)||0,_periodo:2024,_id_poliza:0,_id_cuenta_contable:d.id,_usuario_ingresa:"usrtest",_estado:"A"}],_detalle:m.value};j.show(),await Z.post("/compras",k).then(Q=>{const be=Q.data.fn_insertar_compras_json,[J,U]=be.replace(/[()]/g,"").split(","),ge=parseInt(J);U.replace(/"/g,""),V(`Compra guardada correctamente No.${J} Partida Generada ${U}`,{}),I.value=ge.toString(),y.value=U.toString(),S.value=!0,B.value=!0}).finally(()=>{j.hide()})}},ie=async()=>{if(T.value){const i=await T.value.arrayBuffer(),t=Te(i),f=t.Sheets[t.SheetNames[0]],d=Fe.sheet_to_json(f).map(u=>({documento:u["N\xFAmero del DTE"],serie:u.Serie,fecha:de(u["Fecha de emisi\xF3n"]),tipo:u["Tipo de DTE (nombre)"],proveedor:u["Nombre completo del emisor"],nit:u["NIT del emisor"],total:u["Monto (Gran Total)"],iva:u["IVA (monto de este impuesto)"],Cta:null}));m.value=d}return 0},N=r("eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJBZ2VuY2lhVmlydHVhbERURSIsImlzcyI6IlNBVCIsIm5pdCI6IjEwNDkwOTUwMSIsImV4cCI6MTcyNTY0MTk1MywiaWF0IjoxNzI1NTk4NzUzfQ.2KE72Se31MWfXb3hVNJhluyAh2Fn6Vw-puz7UwbPoTk"),re=()=>{const i=X.create();N.value===""&&(console.log("Hacer login sat"),i.get("http://localhost:5000/get-token").then(t=>{console.log(t.data),N.value=t.data}).catch(t=>console.error("Error:",t)))};function de(i){const t=new Date(i),f=t.getFullYear(),p=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),k=String(t.getMinutes()).padStart(2,"0"),Q=String(t.getSeconds()).padStart(2,"0");return`${f}-${p}-${d} ${u}:${k}:${Q}`}const _=i=>{const[t,f,p]=i.split("/").map(Number),d=p.toString().padStart(2,"0"),u=f.toString().padStart(2,"0");return`${d}-${u}-${t}`},ue=()=>{const i=X.create();console.log(_(F.value),_(D.value)),i.get("http://localhost:5000/get-fact",{headers:{Authorization:N.value},params:{nit:"104909501",fechai:_(F.value),fechaf:_(D.value),tipo:"R"}}).then(t=>{const p=t.data.data.map(d=>({documento:d.numeroDocumento,serie:d.serie,fecha:d.fechaEmision,tipo:d.tipo,proveedor:d.nombreEmisor,nit:d.nitEmisor,total:d.granTotal,iva:d.totalIva}));m.value=p}).catch(t=>console.error("Error:",t))},ce=i=>{m.value=m.value.filter(t=>t.documento!==i)},me=()=>{m.value.push({documento:m.value.length+1})},pe=Y(()=>m.value.reduce((i,t)=>i+parseFloat(t.total||0),0).toFixed(2)),fe=Y(()=>m.value.reduce((i,t)=>i+parseFloat(t.iva||0),0).toFixed(2));return{file:T,parsedCSV:le,visibleDate:oe,fechai:F,fechaf:D,convert:ie,columns:te,compras:m,getdata:re,getFacturas:ue,eliminarFila:ce,agregarFila:me,calculoTotal:pe,calculoIva:fe,onClick:ne,selectedCuentaEnc:n,cuentasn4:e,getCuentasN4:l,cantFacturas:$,txtNoPartida:y,checkPartidaGenerada:S,txtNoCompra:I,mesesDelA\u00F1o:ae,periodoModel:b,mesesModel:z,periodos:ee,disableBTN:B}},mounted(){this.getdata(),this.getCuentasN4()}}),A=e=>(ye("data-v-49f7cefa"),e=e(),Ie(),e),Me={class:"row q-col-gutter-sm"},Ee={class:"col-4"},Pe={class:"col-4"},Ae={class:"col-4"},$e={class:"col-4"},ze={class:"col-2"},Be={class:"col-3 text-right"},Je={class:"col-3"},Ye={class:"col-12"},je={class:"col-12"},Oe={class:"row q-col-gutter-sm"},Ge={class:"col-5"},qe={class:"row items-center justify-end"},He={class:"col-5"},Re={class:"row items-center justify-end"},We={class:"col-2"},Ke={class:"col-12"},Le={class:"row q-ma-sm"},Xe=A(()=>s("div",{class:"col-9"},[s("div",{class:"text-h6"},"Detalle de compras")],-1)),Ze=A(()=>s("div",{class:"col-1"},null,-1)),xe={class:"col"},ea=A(()=>s("strong",null,"Totales:",-1));function aa(e,n,$,S,y,I){return Ce(),_e(ke,{padding:""},{default:o(()=>[a(ve,null,{default:o(()=>[a(M,{label:"Registros Contables",icon:"paid"}),a(M,{label:"Ingreso",icon:"input"}),a(M,{label:"Libro Compras",icon:"shopping_bag"})]),_:1}),a(H,{class:"q-mt-md"},{default:o(()=>[a(O,null,{default:o(()=>[s("div",Me,[s("div",Ee,[a(h,{modelValue:e.txtNoCompra,"onUpdate:modelValue":n[0]||(n[0]=l=>e.txtNoCompra=l),type:"text",label:"No. Interno",outlined:"",dense:"",disable:!0},null,8,["modelValue"])]),s("div",Pe,[a(C,{modelValue:e.mesesModel,"onUpdate:modelValue":n[1]||(n[1]=l=>e.mesesModel=l),options:e.mesesDelA\u00F1o,label:"Mes",outlined:"",dense:"","option-value":"id","option-label":"nombre"},null,8,["modelValue","options"])]),s("div",Ae,[a(C,{modelValue:e.periodoModel,"onUpdate:modelValue":n[2]||(n[2]=l=>e.periodoModel=l),options:e.periodos,label:"Periodo",outlined:"",dense:"","option-value":"id","option-label":"nombre"},null,8,["modelValue","options"])]),s("div",$e,[a(C,{modelValue:e.selectedCuentaEnc,"onUpdate:modelValue":n[3]||(n[3]=l=>e.selectedCuentaEnc=l),options:e.cuentasn4,label:"Cuenta Haber",outlined:"",dense:"","option-value":"id","option-label":"nombre"},null,8,["modelValue","options"])]),s("div",ze,[a(h,{modelValue:e.cantFacturas,"onUpdate:modelValue":n[4]||(n[4]=l=>e.cantFacturas=l),type:"text",label:"Cant. Facturas",outlined:"",dense:"",disable:!0},null,8,["modelValue"])]),s("div",Be,[a(we,{"left-label":"",modelValue:e.checkPartidaGenerada,"onUpdate:modelValue":n[5]||(n[5]=l=>e.checkPartidaGenerada=l),label:"Partida generada",disable:!0},null,8,["modelValue"])]),s("div",Je,[a(h,{modelValue:e.txtNoPartida,"onUpdate:modelValue":n[6]||(n[6]=l=>e.txtNoPartida=l),type:"text",label:"No.Partida",outlined:"",dense:"",disable:!0},null,8,["modelValue"])]),s("div",Ye,[a(Se,{modelValue:e.visibleDate,"onUpdate:modelValue":n[7]||(n[7]=l=>e.visibleDate=l),label:"Consultar SAT"},null,8,["modelValue"])]),s("div",je,[a(L,null,{default:o(()=>[w(s("div",Oe,[s("div",Ge,[a(h,{dense:"",outlined:"",modelValue:e.fechai,"onUpdate:modelValue":n[9]||(n[9]=l=>e.fechai=l),mask:"date",rules:["date"],label:"Fecha Inicial","hide-bottom-space":"",placeholder:"YYYY/MM/DD",clearable:""},{append:o(()=>[a(q,{name:"event",class:"cursor-pointer"},{default:o(()=>[a(R,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[a(W,{modelValue:e.fechai,"onUpdate:modelValue":n[8]||(n[8]=l=>e.fechai=l)},{default:o(()=>[s("div",qe,[w(a(g,{label:"Cerrar",color:"primary",flat:""},null,512),[[K]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",He,[a(h,{dense:"",outlined:"",modelValue:e.fechaf,"onUpdate:modelValue":n[11]||(n[11]=l=>e.fechaf=l),mask:"date",rules:["date"],"hide-bottom-space":"",label:"Fecha Final",placeholder:"YYYY/MM/DD",clearable:""},{append:o(()=>[a(q,{name:"event",class:"cursor-pointer"},{default:o(()=>[a(R,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[a(W,{modelValue:e.fechaf,"onUpdate:modelValue":n[10]||(n[10]=l=>e.fechaf=l)},{default:o(()=>[s("div",Re,[w(a(g,{label:"Cerrar",color:"primary",flat:""},null,512),[[K]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",We,[a(g,{color:"primary",label:"Consultar",onClick:e.getFacturas},null,8,["onClick"])])],512),[[G,e.visibleDate]])]),_:1})]),s("div",Ke,[a(L,null,{default:o(()=>[w(a(De,{modelValue:e.file,"onUpdate:modelValue":[n[12]||(n[12]=l=>e.file=l),e.convert],label:"Seleccione o arraste un archivo para importar(.xls)",outlined:"",accept:".xls",clearable:""},null,8,["modelValue","onUpdate:modelValue"]),[[G,!e.visibleDate]])]),_:1})])])]),_:1})]),_:1}),a(H,{class:"q-mt-sm"},{default:o(()=>[a(O,{class:"q-pt-none"},{default:o(()=>[s("div",Le,[Xe,Ze,s("div",xe,[a(g,{color:"primary",icon:"check",label:"Generar Partida",onClick:e.onClick,disable:e.disableBTN},null,8,["onClick","disable"])])]),a(Ne,{style:{height:"400px"},flat:"",bordered:"","virtual-scroll":"",separator:"cell","rows-per-page-options":[0],class:"my-sticky-header-table",rows:e.compras,columns:e.columns,"row-key":"id",dense:""},{"body-cell-Tipo":o(l=>[a(c,{props:l},{default:o(()=>[a(C,{modelValue:l.row.tipo,"onUpdate:modelValue":b=>l.row.tipo=b,options:[{label:"Factura",value:"FACT"},{label:"Cambiaria",value:"FCAM"},{label:"NC",value:"NCRE"}],borderless:"",dense:"","options-dense":"","map-options":"",class:"full-width"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell":o(l=>[a(c,{props:l},{default:o(()=>[a(h,{modelValue:l.row[l.col.field],"onUpdate:modelValue":b=>l.row[l.col.field]=b,"input-class":"text-right",dense:"",borderless:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-Cta":o(l=>[a(c,{props:l},{default:o(()=>[a(C,{modelValue:l.row.Cta,"onUpdate:modelValue":b=>l.row.Cta=b,options:e.cuentasn4,borderless:"",dense:"","options-dense":"","use-input":"","input-debounce":"0",class:"custom-select","option-value":"id","option-label":"nombre",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["props"])]),"body-cell-acciones":o(l=>[a(c,{props:l},{default:o(()=>[a(g,{flat:"",round:"",icon:"delete",color:"negative",onClick:b=>e.eliminarFila(l.row.documento)},null,8,["onClick"])]),_:2},1032,["props"])]),"bottom-row":o(()=>[a(E,null,{default:o(()=>[a(c,{colspan:"7",class:"text-right"},{default:o(()=>[ea]),_:1}),a(c,{class:"text-right"},{default:o(()=>[s("strong",null,v(e.calculoTotal),1)]),_:1}),a(c,{class:"text-right"},{default:o(()=>[s("strong",null,v(e.calculoTotal),1)]),_:1}),a(c,{class:"text-right"},{default:o(()=>[s("strong",null,v(e.calculoTotal),1)]),_:1}),a(c,{class:"text-right"},{default:o(()=>[s("strong",null,v(e.calculoTotal),1)]),_:1}),a(c,{class:"text-right"},{default:o(()=>[s("strong",null,v(e.calculoTotal),1)]),_:1}),a(c,{class:"text-right"},{default:o(()=>[s("strong",null,v(e.calculoTotal),1)]),_:1}),a(c,{class:"text-right"},{default:o(()=>[s("strong",null,v(e.calculoIva),1)]),_:1})]),_:1})]),bottom:o(l=>[a(E,{props:l},{default:o(()=>[a(c,{colspan:"100%"},{default:o(()=>[a(g,{flat:"",icon:"add",label:"Agregar Fila",onClick:e.agregarFila},null,8,["onClick"])]),_:1})]),_:2},1032,["props"])]),"no-data":o(l=>[a(E,{props:l},{default:o(()=>[a(c,{colspan:"100%"},{default:o(()=>[a(g,{flat:"",icon:"add",label:"Agregar Fila",onClick:e.agregarFila},null,8,["onClick"])]),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1})]),_:1})}var fa=he(Ue,[["render",aa],["__scopeId","data-v-49f7cefa"]]);export{fa as default};
