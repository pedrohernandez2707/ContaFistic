import{h as O}from"./QSelect.2fe94988.js";import{d as J,g as b,_ as M,P as V,o as q,aF as H,w as o,e as l,l as y,i as $,j as w,C as K,aG as N,aH as C,Q as L,aM as W,bp as X,bq as Z,f as s,q as A,r as x,aI as ee}from"./index.91e6d4f7.js";import{Q as ae}from"./QForm.b991f9b4.js";import{Q as Y,a as c}from"./QTable.9a8dde66.js";import{Q as B}from"./QTr.572f8039.js";import{Q as le}from"./QPage.3d26b64d.js";import{s as E,a as S}from"./axios.1d8a1e65.js";import{Q as oe,a as te}from"./QBar.e1a9f0f7.js";import"./selection.f59d8827.js";import"./QList.0fd3cdb9.js";const re=J({name:"BuscadorPartida",emits:["partida-seleccionada"],setup(a,{emit:t}){const g=b(null),h=b(!1),n=b(""),P=[{name:"poliza",label:"Poliza",align:"left",field:"id_poliza",sortable:!0},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion",sortable:!0}],d=b([]),e=b([...d.value]),p=()=>{n.value===null?e.value=d.value:e.value=d.value.filter(v=>v.id_poliza.toLowerCase().includes(n.value)||v.descripcion.toLowerCase().includes(n.value.toLowerCase()))},F=(v,_)=>{h.value=!1,t("partida-seleccionada",_.id_poliza)},I=()=>{h.value=!1},Q=async()=>{var v;h.value=!0,await new Promise(_=>setTimeout(_,250)),(v=g.value)==null||v.focus(),k()},k=()=>{let v=JSON.parse(V.getItem("empresa").toString());if(!v.id){E("Debe Seleccionar la Empresa",{tipo:"negative"});return}let _=V.getItem("periodo");if(!_){E("Debe Seleccionar el Periodo para la Empresa Correspondiente",{tipo:"negative"});return}S.get("partidamanual",{params:{id_empresa:v.id,id_periodo:_}}).then(D=>{d.value=D.data,e.value=D.data})};return{refInputBuscar:g,dialogVisible:h,searchQuery:n,columns:P,partidas:d,filteredPartidas:e,filtrarPartidas:p,seleccionarPartida:F,cerrarDialogo:I,abrirDialogo:Q}}}),ie=a=>(X("data-v-3ae10866"),a=a(),Z(),a),de=ie(()=>s("div",{class:"text-h6"},"Buscador",-1));function ne(a,t,g,h,n,P){return q(),H(W,{modelValue:a.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=d=>a.dialogVisible=d),persistent:""},{default:o(()=>[l(L,{style:{"min-width":"600px"}},{default:o(()=>[l(oe,null,{default:o(()=>[de,l(te),l(y,{dense:"",flat:"",icon:"close",onClick:a.cerrarDialogo},null,8,["onClick"])]),_:1}),l($,null,{default:o(()=>[l(w,{modelValue:a.searchQuery,"onUpdate:modelValue":[t[0]||(t[0]=d=>a.searchQuery=d),a.filtrarPartidas],ref:"refInputBuscar",label:"Buscar partida",dense:"",outlined:"",clearable:"",debounce:"350"},{append:o(()=>[l(K,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),l(Y,{rows:a.filteredPartidas,columns:a.columns,"row-key":"correlativo",style:{height:"400px"},flat:"",bordered:"","virtual-scroll":"",separator:"cell","rows-per-page-options":[0],class:"my-sticky-header-table",onRowDblclick:a.seleccionarPartida,dense:""},{"body-cell-correlativo":o(d=>[l(c,{props:d},{default:o(()=>[N(C(d.row.correlativo),1)]),_:2},1032,["props"])]),"body-cell-nombre":o(d=>[l(c,{props:d},{default:o(()=>[N(C(d.row.nombre),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","onRowDblclick"])]),_:1})]),_:1},8,["modelValue"])}var se=M(re,[["render",ne],["__scopeId","data-v-3ae10866"]]);const U=new Date;U.setHours(0,-U.getTimezoneOffset(),0,0);let T=U.toJSON().slice(0,10);const ue=J({components:{BuscadorPartidas:se},setup(){var z;const a=b(null),t=(z=V.getItem("user"))==null?void 0:z.toString(),g=b(0),h=[{name:"cuenta",label:"Cuenta",align:"left",field:"cuenta",sortable:!0,style:"width: 250px"},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion"},{name:"debe",label:"Debe",align:"right",field:"debe",style:"width: 150px"},{name:"haber",label:"Haber",align:"right",field:"haber",style:"width: 150px;"},{name:"acciones",label:"",field:"",align:"right",style:"width: 40px; padding:5px"}],n=b([{id:1,cuenta:"",descripcion:"",debe:0,haber:0}]),P=b([]),d=b([]),e=b({tipoPartida:"",idPartida:null,fecha:T,descripcion:"",operador:t}),p=b([{label:"Diario",value:"DR"},{label:"Ingreso",value:"ING"},{label:"Egreso",value:"EG"},{label:"Apertura",value:"APE"},{label:"Ajuste",value:"AJU"},{label:"Cierre",value:"cierre"}]),F=A(()=>n.value.reduce((r,i)=>r+(i.debe||0),0).toFixed(2)),I=A(()=>n.value.reduce((r,i)=>r+(i.haber||0),0).toFixed(2)),Q=()=>{const i={id:(n.value.length===0?0:n.value.reduce((u,m)=>m.id>u?m.id:u,n.value[0].id))+1,cuenta:"",descripcion:"",debe:0,haber:0};n.value.push(i)},k=r=>{n.value=n.value.filter(i=>i.id!==r)},v=(r=!1)=>{e.value={tipoPartida:r===!0?e.value.tipoPartida:"",idPartida:null,fecha:T,descripcion:"",operador:e.value.operador},n.value=[{id:1,cuenta:"",descripcion:"",debe:0,haber:0}]},_=()=>{let r=JSON.parse(V.getItem("empresa").toString());if(!V.getItem("periodo")){alert("Debe seleccionar un periodo antes de guardar la partida.");return}let u=V.getItem("periodo").toString();const m={_id_empresa:r.id,_tipo_poliza:e.value.tipoPartida,_fecha:e.value.fecha,_descripcion:e.value.descripcion,_usuario_opero:e.value.operador,_idperiodo:u,_usuario:t,_estado:"A",_detalles:n.value,_id_poliza:""};e.value.idPartida!==null&&e.value.idPartida!==""?(m._id_poliza=e.value.idPartida,S.put("partidamanual",m).then(f=>{alert("Partida actualizada correctamente")})):S.post("partidamanual",m).then(f=>{e.value.idPartida=f.data,alert("Partida generada correctamente")})},D=()=>{const r=V.getItem("empresa");if(r){const i=JSON.parse(r.toString());g.value=i.id}else{alert("Debe seleccionar una empresa");return}S.get("cuentasn4/combo?",{params:{id_empresa:g.value}}).then(i=>{P.value=i.data})},G=()=>{var r;(r=a.value)==null||r.abrirDialogo()},R=r=>{S.get("partidamanual/poliza",{params:{id_poliza:r}}).then(i=>{e.value.idPartida=r,e.value.tipoPartida=i.data.enc.tipo_poliza,e.value.operador=i.data.enc.usuario,e.value.descripcion=i.data.enc.descripcion,e.value.fecha=j(i.data.enc.fecha);let m=i.data.det.map(f=>({id:1,cuenta:{id:f.id_cuenta,nombre:f.descripcion,correlativo:f.correlativo_cuenta,descripcion:f.cuenta},descripcion:f.descripcion,debe:f.debe,haber:f.haber}));n.value=m})};function j(r){const i=new Date(r),u=i.getFullYear(),m=String(i.getMonth()+1).padStart(2,"0"),f=String(i.getDate()).padStart(2,"0");return`${u}-${m}-${f}`}return{refBuscadorPartida:a,columns:h,detallePartida:n,cuentasDisponibles:P,cuentasFilter:d,form:e,tiposPartida:p,totalDebe:F,totalHaber:I,agregarFila:Q,eliminarFila:k,nuevaPartida:v,guardarPartida:_,getCuentasn4:D,showBuscarPartida:G,onBuscarPartida:R,idEmpresa:g,getDatosPartida:()=>{console.log("buscar")},filterCuenta(r,i){if(r===""){i(()=>{d.value=P.value});return}i(()=>{const u=r.toLowerCase();d.value=P.value.filter(m=>m.descripcion.toLowerCase().indexOf(u)>-1)},u=>{r!==""&&u.options.length>0&&(u.setOptionIndex(-1),u.moveOptionSelection(1,!0))})}}},mounted(){const a=V.getItem("empresa");if(!a)alert("Debe seleccionar una empresa antes de acceder a esta p\xE1gina."),this.$router.push("/");else{const t=JSON.parse(a.toString());this.idEmpresa=t.id,this.getCuentasn4()}}}),ce={class:"row q-col-gutter-sm"},pe={class:"col-6"},me={class:"col-5"},fe={class:"col-1"},be={class:"col-6"},ve={class:"col-6"},ge={class:"col-12"},he=s("div",{class:"col-12"},null,-1),Pe={class:"col-12 text-center q-pa-md q-gutter-md"},_e=s("strong",null,"Total:",-1),we={class:"row"},Ve={class:"col"},ye={class:"col text-right"},Se={class:"text-subtitle1"};function Ce(a,t,g,h,n,P){const d=x("buscador-partidas");return q(),H(le,{padding:""},{default:o(()=>[l(L,null,{default:o(()=>[l($,null,{default:o(()=>[l(ae,{onSubmit:ee(a.guardarPartida,["prevent"])},{default:o(()=>[s("div",ce,[s("div",pe,[l(O,{modelValue:a.form.tipoPartida,"onUpdate:modelValue":[t[0]||(t[0]=e=>a.form.tipoPartida=e),t[1]||(t[1]=e=>a.nuevaPartida(!0))],options:a.tiposPartida,label:"Tipo de Partida",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),s("div",me,[l(w,{modelValue:a.form.idPartida,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.idPartida=e),label:"Id Partida",outlined:"",dense:"",disable:""},null,8,["modelValue"])]),s("div",fe,[l(y,{color:"primary",outline:"",icon:"search",onClick:a.showBuscarPartida},null,8,["onClick"])]),s("div",be,[l(w,{modelValue:a.form.operador,"onUpdate:modelValue":t[3]||(t[3]=e=>a.form.operador=e),disable:"",label:"Oper\xF3",outlined:"",dense:""},null,8,["modelValue"])]),s("div",ve,[l(w,{modelValue:a.form.fecha,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.fecha=e),outlined:"",dense:"",type:"date",style:{"color-scheme":"dark"},clearable:""},null,8,["modelValue"])]),s("div",ge,[l(w,{modelValue:a.form.descripcion,"onUpdate:modelValue":t[5]||(t[5]=e=>a.form.descripcion=e),label:"Descripci\xF3n",outlined:"",dense:""},null,8,["modelValue"])]),he,s("div",Pe,[l(y,{label:"Guardar",color:"primary",push:"",class:"btn-fixed-width",onClick:a.guardarPartida},null,8,["onClick"]),l(y,{label:"Nueva Partida",color:"primary",flat:"",class:"btn-fixed-width2",onClick:t[6]||(t[6]=e=>a.nuevaPartida())})])])]),_:1},8,["onSubmit"])]),_:1}),l($,null,{default:o(()=>[l(Y,{style:{height:"400px"},bordered:"","virtual-scroll":"",separator:"cell","rows-per-page-options":[0],class:"my-sticky-header-table",rows:a.detallePartida,columns:a.columns,"row-key":"id",flat:"",dense:""},{"body-cell-cuenta":o(e=>[l(c,{props:e},{default:o(()=>[l(O,{modelValue:e.row.cuenta,"onUpdate:modelValue":p=>e.row.cuenta=p,options:a.cuentasFilter,"option-label":"descripcion","option-value":"correlativo",dense:"",outlined:"","map-options":"","hide-selected":"","hide-bottom-space":"","use-input":"","fill-input":"",clearable:"",onFilter:a.filterCuenta,onFilterAbort:()=>{}},null,8,["modelValue","onUpdate:modelValue","options","onFilter"])]),_:2},1032,["props"])]),"body-cell-descripcion":o(e=>[l(c,{props:e},{default:o(()=>[l(w,{modelValue:e.row.cuenta.nombre,"onUpdate:modelValue":p=>e.row.cuenta.nombre=p,dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-debe":o(e=>[l(c,{props:e},{default:o(()=>[l(w,{modelValue:e.row.debe,"onUpdate:modelValue":p=>e.row.debe=p,type:"number",dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-haber":o(e=>[l(c,{props:e},{default:o(()=>[l(w,{modelValue:e.row.haber,"onUpdate:modelValue":p=>e.row.haber=p,type:"number",dense:"",outlined:"","hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acciones":o(e=>[l(c,{props:e},{default:o(()=>[l(y,{flat:"",round:"",icon:"delete",color:"negative",onClick:p=>a.eliminarFila(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),"bottom-row":o(()=>[l(B,null,{default:o(()=>[l(c),l(c,{class:"text-right"},{default:o(()=>[_e]),_:1}),l(c,{class:"text-right"},{default:o(()=>[s("strong",null,C(a.totalDebe),1)]),_:1}),l(c,{class:"text-right"},{default:o(()=>[s("strong",null,C(a.totalHaber),1)]),_:1}),l(c)]),_:1})]),bottom:o(e=>[l(B,{props:e,style:{width:"100%"}},{default:o(()=>[s("div",we,[s("div",Ve,[l(y,{flat:"",icon:"add",label:"Agregar Fila",onClick:a.agregarFila},null,8,["onClick"])]),s("div",ye,[s("div",Se," Filas: "+C(a.detallePartida.length),1)])])]),_:2},1032,["props"])]),"no-data":o(e=>[l(B,{props:e},{default:o(()=>[l(c,{colspan:"100%"},{default:o(()=>[l(y,{flat:"",icon:"add",label:"Agregar Fila",onClick:a.agregarFila},null,8,["onClick"])]),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1}),l(d,{ref:"refBuscadorPartida",onPartidaSeleccionada:a.onBuscarPartida},null,8,["onPartidaSeleccionada"])]),_:1})}var Ae=M(ue,[["render",Ce]]);export{Ae as default};
